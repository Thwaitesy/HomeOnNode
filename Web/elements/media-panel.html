<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="/bower_components/paper-dropdown/paper-dropdown.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">
<link rel="import" href="/bower_components/core-menu/core-menu.html">

<polymer-element name="media-panel" attributes="devices activity">
  <template>
    <link no-shim href="/styles/pbutton.css" rel="stylesheet">
    <div layout start-justified wrap horizontal>
      <template repeat="{{devices as device}}">
        <paper-button pushed?="{{pushedActivity==device.harmony}}" colored?="{{activity==device.harmony}}" on-tap="{{tapButton}}" device="{{device}}" flex>
          {{device.label}}
        </paper-button>
      </template>
    </div>
  </template>
  <script type="text/javascript">
    /* jshint browser: true */
    /* global fb */
    'use strict';

    Polymer({
      created: function() {
        this.devices = [];
        this.activity = '';
        this.pushedActivity = '';
        var self = this;
        fb.child('state/harmony/label').on('value', function(snapshot) {
          self.activity = snapshot.val();
          self.pushedActivity = '';
        });
        fb.child('config/commands').on('value', function(snapshot) {
          self.devices = window.getCommands(snapshot.val(), 'media');
        });
      },
      tapButton: function(event, details, sender) {
        var cmd = {
          command: sender.templateInstance.model.device.command
        };
        this.pushedActivity = sender.templateInstance.model.device.harmony;
        window.lastEvent = Date.now();
        console.log('tapButton', cmd);
        fb.child('commands').push(cmd);
      }
    });
  </script>
</polymer-element>
