<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="../bower_components/core-icons/device-icons.html">
<link rel="import" href="../bower_components/core-icons/social-icons.html">
<link rel="import" href="../bower_components/core-icons/image-icons.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">


<polymer-element name="nav-drawer">
  <template>
    <style>
      hr {
        border: 0;
        border-bottom: 1px solid #b6b6b6;
      }
      header {
        min-height: 100px;
        background-color: #0288d1;
        color: #ffffff;
      }
      ul {
        margin: 0;
        list-style: none;
        -webkit-padding-start: 0;
      }
      core-icon {
        margin-right: 1em;
      }
      paper-button {
        width: 100%;
        margin: 0;
        border-radius: 0;
        text-transform: none;
      }
      paper-button a,
      paper-button span {
        margin-right: auto;
        vertical-align: middle;
      }
      a {
        color: inherit;
        text-decoration: none;
        text-align: left;
      }
      #status {
        font-size: 0.75em;
      }
      #status span {
        display: inline-block;
        width: 40%;
      }
      @media screen and (max-height: 400px) {
        header {
          min-height: 0px;
          max-height: 0px;
        }
        paper-button {
          font-size: 0.80em;
        }
        core-icon {
          height: 18px !important;
          width: 18px !important;
        }
      }
    </style>
    <div vertical layout fit>
      <header horizontal layout end>

      </header>
      <div flex>
        <ul>
          <li>
            <paper-button on-tap="{{tapButton}}" page="devices">
              <core-icon icon="device:devices"></core-icon>
              <span>Devices</span>
            </paper-button>
          </li>
          <li>
            <paper-button on-tap="{{tapButton}}" page="doorLogs">
              <core-icon src="../images/door.png"></core-icon>
              <span>Door Logs</span>
            </paper-button>
          </li>
          <li>
            <paper-button on-tap="{{tapButton}}" page="systemLogs">
              <core-icon icon="query-builder"></core-icon>
              <span>System Logs</span>
            </paper-button>
          </li>
          <li>
            <paper-button on-tap="{{tapButton}}" page="presence">
              <core-icon icon="social:people"></core-icon>
              <span>Presence</span>
            </paper-button>
          </li>
          <li>
            <paper-button on-tap="{{tapButton}}" page="errors">
              <core-icon icon="error"></core-icon>
              <span>Errors</span>
            </paper-button>
          </li>
        </ul>
        <hr>
        <ul>
          <li>
            <paper-button>
              <a href="https://www.dropcam.com/watch/c1fcd270197f4e7fb1f517d48166be3c" target="_blank">
                <core-icon icon="image:photo-camera"></core-icon>
                <span>Dropcam</span>
              </a>
            </paper-button>
          </li>
        </ul>
        <hr>
        <ul>
          <li>
            <paper-button on-tap="{{tapButton}}" page="settings">
              <core-icon icon="settings"></core-icon>
              <span>Settings</span>
            </paper-button>
          </li>
        </ul>
      </div>
      <div id="status">
        <div><span>Version:</span> {{version}} ({{ghVersion}})</span></div>
        <div><span>Started:</span> {{startedAt}}</div>
        <div><span>Last Updated:</span> {{lastUpdatedAt}}</div>
      </div>

    </div>



    <core-ajax auto
      url="https://api.github.com/repos/petele/HomeOnNode/commits"
      handleAs="json"
      on-core-response="{{handleResponse}}">
    </core-ajax>
  </template>
  <script type="text/javascript">
    Polymer({
      created: function() {
        this.version = "";
        this.ghVersion = "";
        this.startedAt = "";
        this.lastUpdatedAt = "";
      },
      formatDate: function(dt) {
        if (dt) {
          return moment(dt).format("M/D/YY, h:mm:ss a");
        } else {
          return "";
        }
      },
      ready: function() {
        var self = this;
        fb.child("state/time/last_updated").on("value", function(snapshot) {
          self.lastUpdatedAt = self.formatDate(snapshot.val());
        });
        fb.child("state/time/started").on("value", function(snapshot) {
          self.startedAt = self.formatDate(snapshot.val());
        });
        fb.child("state/version").on("value", function(snapshot) {
          self.version = snapshot.val();
        });
      },
      tapButton: function(event, details, sender) {
        var page = sender.getAttribute("page");
        var cap = document.querySelector("core-animated-pages");
        cap.selected = page;

        var h = {
          "panel": page,
          "tab": this.selectedTab
        };
        console.log("Push State", h);

        history.pushState(h, null, "/" + page);

        setTimeout(function() {
          var primaryPanel = document.querySelector("primary-panel");
          primaryPanel.$.drawer.closeDrawer();
        }, 500);
        window.lastEvent = Date.now();
      },
      handleResponse: function(event, details, sender) {
        this.ghVersion = details.response[0].sha.substring(0, 7);
      }
    });
  </script>
</polymer-element>
