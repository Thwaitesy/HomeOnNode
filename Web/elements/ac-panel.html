<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">


<polymer-element name="ac-panel" attributes="devices">
  <template>
    <link rel="stylesheet" type="text/css" href="/styles/main.css">
    <style type="text/css">
      .acTemp {
        min-width: 1.1em;
        text-align: center;
      }
      .acTemp[disabled] {
        color: #c9c9c9;
        opacity: 0;
      }
      .fastCool {
        background-color: white;
        border-radius: 50%;
        border: 1px solid #e0e0e0;
      }
      paper-toggle-button::shadow [checked] .toggle {
        background-color: #03A9F4;
      }
      paper-toggle-button::shadow [checked] .toggle-ink {
        color: #81D4FA;
      }
      paper-icon-button.lm {
        margin-left: 20px;
        margin-right: 12px;
      }
      paper-icon-button.rm {
        margin-left: 12px;
        margin-right: 0px;
      }
      li {
        min-height: 40px;
        margin-bottom: 1vw;
      }
      ul {
        padding-left: 0;
        margin-top: 0;
        list-style-type: none;
      }
    </style>
    <ul vertical layout class="text-large">
      <li horizontal layout center>
        <span flex>Fast Cool</span>
        <paper-icon-button class="rm fastCool" on-tap="{{fastCool}}" src="/images/snowflake.png"></paper-icon-button>
      </li>
      <template repeat="{{devices as device}}">
        <li horizontal layout center>
          <span flex>{{device.label}}</span>
          <paper-toggle-button on-change="{{toggleAC}}" checked?="{{device.temp > 0}}"></paper-toggle-button>
          <paper-icon-button class="lm" on-tap="{{tempDown}}" disabled?="{{device.temp <= 60 || device.temp == 0}}" icon="expand-more"></paper-icon-button>
          <div class="acTemp" disabled?="{{device.temp == 0}}">{{device.temp}}</div>
          <paper-icon-button class="rm" on-tap="{{tempUp}}" disabled?="{{device.temp >= 75 || device.temp == 0}}" icon="expand-less"></paper-icon-button>
        </li>
      </template>
    </ul>
  </template>
  <script type="text/javascript">
    /* jshint browser: true */
    /* global fb */
    'use strict';

    Polymer({
      created: function() {
        this.devices = [];
        var self = this;
        fb.child("state/hvac").on("value", function(snapshot) {
          var val = snapshot.val();
          var devices = [
            {"label": "Living Room", "command": "LR_AC", "id": "LR", "temp": val.LR.temperature},
            {"label": "Kitchen", "command": "KI_AC", "id": "KI", "temp": val.KI.temperature},
            {"label": "Bed Room", "command": "BR_AC", "id": "BR", "temp": val.BR.temperature}
          ];
          self.devices = devices;
        });
      },
      fastCool: function(event, details, sender) {
        var cmd = {
          "command": "FAST_COOL"
        };
        window.lastEvent = Date.now();
        console.log("fastCool", cmd);
        fb.child("commands").push(cmd);
      },
      toggleAC: function(event, details, sender) {
        var device = sender.templateInstance.model.device;
        var cmd = {
          "command": device.command
        }
        if (device.temp == 0) {
          device.temp = 72;
        } else {
          cmd.modifier = "Off";
          device.temp = 0;
        }
        window.lastEvent = Date.now();
        console.log("toggleAC", cmd);
        fb.child("commands").push(cmd);
      },
      tempUp: function(event, details, sender) {
        var newTemp = sender.templateInstance.model.device.temp + 1;
        sender.templateInstance.model.device.temp = newTemp;
        var cmd = {
          "command": sender.templateInstance.model.device.command,
          "modifier": "UP"
        };
        window.lastEvent = Date.now();
        console.log("tempUp", cmd);
        fb.child("commands").push(cmd);
      },
      tempDown: function(event, details, sender) {
        var newTemp = sender.templateInstance.model.device.temp - 1;
        sender.templateInstance.model.device.temp = newTemp;
        var cmd = {
          "command": sender.templateInstance.model.device.command,
          "modifier": "DOWN"
        };
        window.lastEvent = Date.now();
        console.log("tempDown", cmd);
        fb.child("commands").push(cmd);
      }
    });
  </script>
</polymer-element>
