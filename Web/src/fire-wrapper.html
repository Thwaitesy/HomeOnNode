<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="fire-wrapper">
  <template>
  </template>
  <script src="/scripts/idb-keyval.js">
  </script>
  <script>
    class FireWrapper extends Polymer.Element {
      static get is() { return 'fire-wrapper'; }

      static get properties() {
        return {
          data: {
            type: Object,
            notify: true,
            reflectToAttribute: true,
          },
          liveData: {
            type: Object,
            notify: true,
            reflectToAttribute: true,
          },
          path: {
            type: String,
          },
        };
      }

      static get observers() {
        return [
          '_liveDataChanged(liveData.*)',
        ];
      }

      ready() {
        super.ready();
        idbKeyval.get(this.path)
          .then((value) => {
            console.log('fw-get', this.path, value);
            if (value) {
              this.data = value;
            }
          });
      }

      _liveDataChanged(event) {
        let value = event.value;
        if (typeof value === 'object' && Object.keys(value).length === 0) {
          console.log('liveDataChanged', this.path, 'None - quit');
          return;
        }
        console.log('liveDataChanged', this.path, value);
        this.data = value;
        idbKeyval.set(this.path, value);
      }

    }

    window.customElements.define(FireWrapper.is, FireWrapper);
  </script>
</dom-module>
